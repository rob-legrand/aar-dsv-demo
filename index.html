<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html dir="ltr" lang="en-US" xmlns="http://www.w3.org/1999/xhtml"><head><title>AAR DSV demo</title>

<link href="style.css" rel="stylesheet" type="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta name="author" content="Rob LeGrand" />
<meta name="description" content="An interactive demo of AAR DSV and other ratings-aggregation procedures." />
<meta name="keywords" content="rob legrand, legrand, angelo state, asu, computer science, computational social choice, voting, aar dsv" />
<meta name="language" content="en-US" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />

<style type="text/css">
#votespace {
   border: 1px solid #000000;
   background-color: #ffffff;
   display: block;
   margin-left: auto;
   margin-right: auto;
}
</style>
</head><body>
<div class="bigtop">AAR DSV demo</div>
<p>Drag the vote points around inside the votespace and the outcomes will be updated automatically.
   <div>
      <label for="select-n">Number of voters:&nbsp;</label>
      <select id="select-n">
         <option>2</option>
         <option>3</option>
         <option>4</option>
         <option selected="selected">5</option>
         <option>6</option>
         <option>7</option>
         <option>8</option>
         <option>9</option>
      </select>
   </div>
</p>
<canvas height="601" id="votespace" width="601">
For this demo you need a browser that supports the <code>&lt;canvas&gt;</code> element with JavaScript enabled.&nbsp; <a href="http://www.opera.com/">Opera</a> and
<a href="http://www.google.com/chrome/">Google Chrome</a> are recommended.
</canvas>
<ul>
<li><span style="background-color: #000000; color: #ff5555; font-weight: bold;">Red</span> = Per-dimension midrange</li>
<li><span style="background-color: #000000; color: #ffaa00; font-weight: bold;">Orange</span> = Average</li>
<li><span style="background-color: #000000; color: #ffff00; font-weight: bold;">Yellow</span> = AAR DSV</li>
<li><span style="background-color: #000000; color: #aaff00; font-weight: bold;">Lime</span> = Per-dimension median</li>
<li><span style="background-color: #000000; color: #55ff55; font-weight: bold;">Green</span> = Fermat-Weber point</li>
</ul>

<script type="text/javascript">
var runDemo = function () {

   var getTrueOffsetLeft = function (ele) {
      var n = 0;
      while (ele !== null) {
         if (ele.offsetLeft !== null) {
            n += ele.offsetLeft;
         }
         ele = ele.offsetParent;
      }
      return n;
   };

   var getTrueOffsetTop = function (ele) {
      var n = 0;
      while (ele !== null) {
         if (ele.offsetTop !== null) {
            n += ele.offsetTop;
         }
         ele = ele.offsetParent;
      }
      return n;
   };

   var x, y;
   var numVoters = 5;
   var votespaceCanvas = document.getElementById('votespace');
   var width = votespaceCanvas.width;
   var height = votespaceCanvas.height;

   if (!votespaceCanvas.getContext) {
      return;
   }

   var randomizePoints = function () {
      var i;
      x = [];
      y = [];
      for (i = 0; i < numVoters; ++i) {
         x[i] = (Math.random() - 0.5) * width;
         y[i] = (Math.random() - 0.5) * height;
      }
   };
   randomizePoints();

   var redrawSpace = function (pointBeingDragged) {
      var i;
      votespaceContext.clearRect(-width / 2, -height / 2, width, height);

      // draw vote points
      for (i = 0; i < numVoters; ++i) {
         votespaceContext.beginPath();
         votespaceContext.fillStyle = pointBeingDragged === i ? '#aa55ff' : '#55aaff';
         votespaceContext.moveTo(x[i], -y[i]);
         votespaceContext.arc(x[i], -y[i], 6, 0, Math.PI * 2, true);
         votespaceContext.fill();
      }

      // find Average outcome of vote points
      var avgX = 0;
      var avgY = 0;
      for (i = 0; i < numVoters; ++i) {
         avgX += x[i];
         avgY += y[i];
      }
      avgX /= numVoters;
      avgY /= numVoters;

      // find Median outcome of vote points
      var sortX = x.slice(0);
      var sortY = y.slice(0);
      if (numVoters % 2 === 0) {
         sortX = sortX.concat(0);
         sortY = sortY.concat(0);
      }
      sortX.sort(function (a, b) {
         return a - b;
      });
      sortY.sort(function (a, b) {
         return a - b;
      });
      var medX = sortX[Math.floor(numVoters / 2)];
      var medY = sortY[Math.floor(numVoters / 2)];

      // find AAR DSV outcome of vote points
      sortX = x.slice(0);
      sortY = y.slice(0);
      for (i = 1; i < numVoters; ++i) {
         sortX = sortX.concat(-width / 2 + i * width / numVoters);
         sortY = sortY.concat(-height / 2 + i * height / numVoters);
      }
      sortX.sort(function (a, b) {
         return a - b;
      });
      sortY.sort(function (a, b) {
         return a - b;
      });
      var dsvX = sortX[numVoters - 1];
      var dsvY = sortY[numVoters - 1];

      // find Midrange outcome of vote points
      sortX = x.slice(0);
      sortY = y.slice(0);
      sortX.sort(function (a, b) {
         return a - b;
      });
      sortY.sort(function (a, b) {
         return a - b;
      });
      var midX = (sortX[0] + sortX[numVoters - 1]) / 2;
      var midY = (sortY[0] + sortY[numVoters - 1]) / 2;

      // find Fermat-Weber outcome of vote points with Weiszfeld's algorithm
      var ferX = (Math.random() - 0.5) * width;
      var ferY = (Math.random() - 0.5) * height;
      var numX, numY, den, oldFerX, oldFerY;
      do {
         numX = 0;
         numY = 0;
         den = 0;
         for (i = 0; i < numVoters; ++i) {
            sumSqDiff = (x[i] - ferX) * (x[i] - ferX) + (y[i] - ferY) * (y[i] - ferY);
            if (sumSqDiff > 0) {
               dist = Math.sqrt(sumSqDiff);
               numX += x[i] / dist;
               numY += y[i] / dist;
               den += 1 / dist;
            }
         }
         oldFerX = ferX;
         oldFerY = ferY;
         ferX = numX / den;
         ferY = numY / den;
      } while (ferX > oldFerX + 0.01 || ferX + 0.01 < oldFerX || ferY > oldFerY + 0.01 || ferY + 0.01 < oldFerY);

      // draw outcome points
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#000000';
      votespaceContext.moveTo(midX, -midY);
      votespaceContext.arc(midX, -midY, 8, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#000000';
      votespaceContext.moveTo(medX, -medY);
      votespaceContext.arc(medX, -medY, 8, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#000000';
      votespaceContext.moveTo(ferX, -ferY);
      votespaceContext.arc(ferX, -ferY, 8, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#000000';
      votespaceContext.moveTo(avgX, -avgY);
      votespaceContext.arc(avgX, -avgY, 8, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#000000';
      votespaceContext.moveTo(dsvX, -dsvY);
      votespaceContext.arc(dsvX, -dsvY, 8, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#ff5555';
      votespaceContext.moveTo(midX, -midY);
      votespaceContext.arc(midX, -midY, 6, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#aaff00';
      votespaceContext.moveTo(medX, -medY);
      votespaceContext.arc(medX, -medY, 6, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#55ff55';
      votespaceContext.moveTo(ferX, -ferY);
      votespaceContext.arc(ferX, -ferY, 6, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#ffaa00';
      votespaceContext.moveTo(avgX, -avgY);
      votespaceContext.arc(avgX, -avgY, 6, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#ffff00';
      votespaceContext.moveTo(dsvX, -dsvY);
      votespaceContext.arc(dsvX, -dsvY, 6, 0, Math.PI * 2, true);
      votespaceContext.fill();
   };

   var votespaceContext = votespaceCanvas.getContext('2d');
   votespaceContext.translate(width / 2, height / 2);
   redrawSpace();

   document.getElementById('select-n').onchange = function () {
      numVoters = Number(this.options[this.options.selectedIndex].value);
      randomizePoints();
      redrawSpace();
   };

   // returns the mouse location as a two-element array that gives the relative (x, y) values
   var getMouse = function (e) {
      var x = e.clientX - getTrueOffsetLeft(votespaceCanvas) + window.pageXOffset;
      var y = e.clientY - getTrueOffsetTop(votespaceCanvas) + window.pageYOffset;
      return [Math.min(width - 3, Math.max(3, x)), Math.min(height - 3, Math.max(3, y))];
   };

   votespaceCanvas.onmousedown = function (e) {
      var i, mouse = getMouse(e);

      // for each point
      for (i = 0; i < numVoters; ++i) {
         // if the Euclidean distance between the mouse click and this point is less than 10 pixels
         if ((mouse[0] - x[i] - width / 2) * (mouse[0] - x[i] - width / 2) + (height / 2 - mouse[1] - y[i]) * (height / 2 - mouse[1] - y[i]) < 100) {
            document.onmousemove = function (e) {
               var mouse = getMouse(e);
               x[i] = mouse[0] - width / 2 + i / numVoters;
               y[i] = height / 2 - mouse[1] + i / numVoters;
               redrawSpace(i);
            };
            document.onmousemove(e);
            document.onmouseup = function () {
               document.onmousemove = null;
               redrawSpace();
            };
            break;
         }
      }
      return true;
   };
};

runDemo();
</script>

</body></html>

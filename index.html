<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- originally got some ideas from http://www.benjoffe.com/code/demos/interpolate/ -->

<html dir="ltr" lang="en-US"><head><title>AAR DSV demo</title>

<link href="style.css" rel="stylesheet" type="text/css" />
<meta name="Content-Type" content="text/html" />
<meta name="Content-Script-Type" content="text/javascript" />
<meta name="Content-Style-Type" content="text/css" />
<meta name="author" content="Rob LeGrand" />
<meta name="description" content="An interactive demo of AAR DSV and other ratings-aggregation procedures." />
<meta name="keywords" content="rob legrand, legrand, angelo state, asu, computer science, computational social choice, voting, aar dsv" />
<meta name="language" content="en-US" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />

<style type="text/css">
#content em {
   color: #3377dd;
   font-style: normal;
   font-weight: bold;
}
#content label {
   display: block;
   margin-top: 8px;
}
#votespace {
   border: 1px solid #000000;
   box-shadow: 0px 0px 64px 0px #000000;
   display: block;
   margin-left: auto;
   margin-right: auto;
}
</style>
<script type="text/javascript">
var runDemo = function () {
   var getTrueOffsetLeft = function (ele) {
      var n = 0;
      while (ele) {
         n += ele.offsetLeft || 0;
         ele = ele.offsetParent;
      }
      return n;
   };

   var getTrueOffsetTop = function (ele) {
      var n = 0;
      while (ele) {
         n += ele.offsetTop || 0;
         ele = ele.offsetParent;
      }
      return n;
   };

   var numVoters = 3, x, y;
   var votespaceCanvas = document.getElementById('votespace');
   var width = votespaceCanvas.width;
   var height = votespaceCanvas.height;

   if (!votespaceCanvas.getContext)
      return;

   var randomizePoints = function () {
      var i;
      x = [];
      y = [];
      for (i = 0; i < numVoters; ++i) {
         x[i] = (Math.random() - 0.5) * width;
         y[i] = (Math.random() - 0.5) * height;
      }
   };
   randomizePoints();

   var redrawSpace = function (hoveringPoint, draggingPoint) {
      var i;
      votespaceContext.clearRect(-width / 2, -height / 2, width, height);

      votespaceContext.fillStyle = '#ccccff';

      for (i = 0; i < numVoters; ++i) {
         votespaceContext.beginPath();
         votespaceContext.fillStyle = draggingPoint === i ? '#ff6699' : '#6699ff';
         votespaceContext.moveTo(x[i], -y[i]);
         votespaceContext.arc(x[i], -y[i], 6, 0, Math.PI * 2, true);
         votespaceContext.fill();
      }

      // find average of vote points and draw it
      var avgX = 0;
      var avgY = 0;
      for (i = 0; i < numVoters; ++i) {
         avgX += x[i];
         avgY += y[i];
      }
      avgX /= numVoters;
      avgY /= numVoters;
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#000000';
      votespaceContext.moveTo(avgX, -avgY);
      votespaceContext.arc(avgX, -avgY, 8, 0, Math.PI * 2, true);
      votespaceContext.fill();
      votespaceContext.beginPath();
      votespaceContext.fillStyle = '#ffff00';
      votespaceContext.moveTo(avgX, -avgY);
      votespaceContext.arc(avgX, -avgY, 6, 0, Math.PI * 2, true);
      votespaceContext.fill();
   };

   var votespaceContext = votespaceCanvas.getContext('2d');
   votespaceContext.translate(width / 2, height / 2);
   redrawSpace();

   document.getElementById('select-n').onchange = function () {
      numVoters = Number(this.options[this.options.selectedIndex].value);
      randomizePoints();
      redrawSpace();
   };

   // returns the mouse location as a two-element array that gives the relative (x, y) values
   var getMouse = function (e) {
      var x = e.clientX - getTrueOffsetLeft(votespaceCanvas) + window.pageXOffset;
      var y = e.clientY - getTrueOffsetTop(votespaceCanvas) + window.pageYOffset;
      return [Math.min(width - 3, Math.max(3, x)), Math.min(height - 3, Math.max(3, y))];
   };

   votespaceCanvas.onmousedown = function (e) {
      var i, mouse = getMouse(e);
      // for each point
      for (i = 0; i < numVoters; ++i) {
         // if the Euclidean distance between the mouse click and this point is less than 10 pixels
         if ((mouse[0] - x[i] - width / 2) * (mouse[0] - x[i] - width / 2) + (height / 2 - mouse[1] - y[i]) * (height / 2 - mouse[1] - y[i]) < 100) {
            document.onmousemove = function (e) {
               var mouse = getMouse(e);
               x[i] = mouse[0] - width / 2 + i / numVoters;
               y[i] = height / 2 - mouse[1] + i / numVoters;
               redrawSpace(-1, i);
            };
            document.onmousemove(e);
            document.onmouseup = function () {
               document.onmousemove = null;
               redrawSpace();
            };
            break;
         }
      }
      return true;
   };
};
</script>

</head><body>

<div id="content">
<div class="bigtop">AAR DSV demo</div>
<p>
   Drag and drop the vote points inside the votespace and the average outcome will be updated automatically.
   <label>
      Number of voters:&nbsp;
      <select id="select-n">
         <option>2</option>
         <option selected>3</option>
         <option>4</option>
         <option>5</option>
         <option>6</option>
         <option>7</option>
         <option>8</option>
         <option>9</option>
      </select>
   </label>
</p>
<canvas height="601" id="votespace" width="601">
For this demo you need a browser that supports the <code>&lt;canvas&gt;</code> HTML element with JavaScript enabled such as <a href="http://www.opera.com/">Opera</a>.
</canvas>
<script type="text/javascript">runDemo();</script>
</div>

</body></html>
